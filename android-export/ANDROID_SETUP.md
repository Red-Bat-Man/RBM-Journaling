# RBM Journal Mobile App Setup

This document explains how the RBM Journal Android app works and how to deploy it to connect to your backend.

## Architecture Overview

The Android app is a hybrid application built using Capacitor, which allows us to package our web app into a native Android application. Here's how it works:

1. **Web Application**: Our React.js application is built and bundled for production.
2. **Capacitor**: Wraps the web app in a WebView and provides native bridges to device features.
3. **Remote Backend**: The mobile app connects to a deployed backend server instead of running a local server.

## Features Supported in Mobile

The mobile version of RBM Journal supports all the key features of the web application:

- User authentication (login/register)
- Creating and viewing journal entries
- Tracking emotions, people, and places
- Viewing favorite entries
- Customizable text settings
- Voice recording for journal entries

## Key Files

- `capacitor.config.ts`: Contains configuration for the Capacitor framework, including the backend URL.
- `client/mobile.html`: The entry point HTML file specifically designed for mobile.
- `client/src/mobile-entry.tsx`: The mobile-specific JavaScript entry point that sets up API redirects.
- `android/`: The complete Android project generated by Capacitor.

## How to Deploy

### 1. Deploy the Backend

First, you need to deploy your backend server so it's accessible from the internet:

1. Click the "Deploy" button in your Replit project.
2. Once deployed, note the URL of your deployed app (e.g., `https://your-journal-app.replit.app`).

### 2. Update Capacitor Configuration

Update the `capacitor.config.ts` file to point to your deployed backend:

```typescript
const config: CapacitorConfig = {
  // ...other config...
  server: {
    androidScheme: 'https',
    url: 'https://your-journal-app.replit.app', // Your deployed backend URL
    cleartext: true
  },
  // ...other config...
};
```

### 3. Build the Android App

Due to Replit's environment limitations, you'll need to export the project and build it on a local machine with Android Studio:

1. Run the export script: `./export-android-project.sh`
2. Download the generated zip file.
3. Extract the zip on your local machine.
4. Follow the build instructions in the extracted `BUILD_INSTRUCTIONS.md` file.

### 4. Install the App

After building, you can install the APK on your Android device using one of these methods:

- Connect your device via USB and use `adb install app-debug.apk`
- Transfer the APK to your device and install it directly.
- Upload the APK to a distribution platform like Google Play Store (requires signing).

## How the Mobile App Connects to the Backend

The mobile app uses a different approach from the web version:

1. In the web version, the frontend and backend run on the same domain.
2. In the mobile app, API requests are redirected to your deployed backend URL.

This redirection happens in `mobile-entry.tsx`:

```typescript
// Simplified example
function getApiBaseUrl() {
  if (Capacitor.isNativePlatform()) {
    return Capacitor.getPluginImplementation<any>('WebView')?.getServerUrl() || '';
  }
  return 'https://your-journal-app.replit.app';
}

// Override fetch for API requests
window.fetch = async (input, init) => {
  let url = input.toString();
  if (url.startsWith('/api/')) {
    url = `${getApiBaseUrl()}${url}`;
    // Make the request to the remote server
  }
  // ...
};
```

## Authentication in the Mobile App

The mobile app maintains authentication using cookies, just like the web version:

1. When a user logs in, the backend sets a cookie.
2. Subsequent API requests include this cookie for authentication.
3. The `credentials: 'include'` option ensures cookies are sent with cross-origin requests.

## Troubleshooting

- **Connection Issues**: Make sure your backend URL is correct and the server is running.
- **CORS Errors**: The backend must allow requests from the mobile app. This is already configured in the server.
- **Authentication Problems**: Check if cookies are being properly sent and received.

For further assistance, refer to the Capacitor documentation: https://capacitorjs.com/docs